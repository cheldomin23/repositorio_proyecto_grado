"use strict";function _classCallCheck(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,a){for(var r=0;r<a.length;r++){var t=a[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}function _createClass(e,a,r){return a&&_defineProperties(e.prototype,a),r&&_defineProperties(e,r),e}var _require=require("../helpers"),JwtHelper=_require.JwtHelper,_userService=null,bcryptjs=require("bcryptjs"),AuthService=function(){function r(e){var a=e.userService;_classCallCheck(this,r),_userService=a}return _createClass(r,[{key:"login",value:function(a){var r,t,n,s;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.email,e.next=3,regeneratorRuntime.awrap(_userService.getUserByEmail(r));case 3:if(t=e.sent){e.next=6;break}return e.abrupt("return",{ok:!1,profile:null,token:null,message:"Credencial de usuario invalida"});case 6:if(bcryptjs.compareSync(a.password,t.dataValues.password)){e.next=8;break}return e.abrupt("return",{ok:!1,profile:null,token:null,message:"Credencial invalida"});case 8:return n={firstName:t.dataValues.firstName,middlename:t.dataValues.middlename,lastname:t.dataValues.lastname,lastname2:t.dataValues.lastname2,email:t.dataValues.email,id:t.dataValues.id,avatar:"../../app/public/resources/avatars/0.png"},s=JwtHelper(n),e.abrupt("return",{ok:!0,profile:n,token:s,message:"Bienvenido"});case 11:case"end":return e.stop()}})}},{key:"relogin",value:function(a){var r,t,n;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(_userService.getUserByEmail(a.email));case 2:return r=e.sent,t={id:r.dataValues.id,firstName:r.dataValues.firstName,middlename:r.dataValues.middlename,lastname:r.dataValues.lastname,lastname2:r.dataValues.lastname2,email:r.dataValues.email,avatar:"../../app/public/resources/avatars/0.png"},n=JwtHelper(t),e.abrupt("return",{ok:!0,profile:t,token:n,message:"Bienvenido"});case 6:case"end":return e.stop()}})}}]),r}();module.exports=AuthService;